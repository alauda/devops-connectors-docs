---
created: '2025-01-01'
title: Connectors CSI Driver
weight: 30
sourceSHA: 9091741bd4c766d04451b1397900bfa0d600d3e58d1d3dadf78d24d8091d2947
---

# Connectors CSI Driver

## Overview

The Connectors CSI Driver is a storage driver implemented based on the Container Storage Interface (CSI) specification. It can mount configurations from the Connector as volumes into Kubernetes workloads. Key features include:

- Mounting configuration files from the Connector into Pods
- Supporting dynamic variable rendering in configuration files to automatically inject runtime information
- Supporting the simultaneous mounting of multiple configuration files

All configuration data comes from the [ConnectorClass configuration](./connectorclass.mdx#configurations) associated with the Connector.

## Quick Start

### 1. Create a ConnectorClass

First, create a ConnectorClass that includes Git configuration:

```shell
cat << EOF | kubectl apply -f -
apiVersion: connectors.alauda.io/v1alpha1
kind: ConnectorClass
metadata:
  name: my-git
spec:
  address:
    type: string
  configurations:
  - name: config
    data:
      .gitconfig: |
        this is git config
EOF
```

### 2. Create a Connector

Then, create a Connector that connects to GitHub:

```shell
cat << EOF | kubectl apply -f -
apiVersion: connectors.alauda.io/v1alpha1
kind: Connector
metadata:
  name: git-connector
spec:
  address: https://github.com
  connectorClassName: my-git
EOF
```

### 3. Create a Pod Using the CSI Driver

Create a Pod that mounts the configuration:

```shell
cat << EOF | kubectl create -f -
apiVersion: v1
kind: Pod
metadata:
  name: csi-demo
  namespace: default
spec:
  restartPolicy: Never
  containers:
  - name: web
    image: bitnami/git:2.47.1
    imagePullPolicy: IfNotPresent
    command: ["sleep", "3600"]
    volumeMounts:
    - name: git-config
      mountPath: /tmp/config
  volumes:
  - name: git-config
    csi:
      readOnly: true
      driver: connectors-csi
      volumeAttributes:
        connector.name: "git-connector"
        connector.namespace: "default"
        configuration.names: "config"
EOF
```

Verify the mounted files:

```shell
# List all mounted files (including built-in configurations)
kubectl exec -ti csi-demo -- ls -l /tmp/config

# View the custom configuration from ConnectorClass
kubectl exec -ti csi-demo -- cat /tmp/config/.gitconfig
```

## Built-in Configurations \{#built-in-configurations}

The CSI Driver automatically provides built-in configuration files that are always mounted into Pods.

| File Name                        | Description                                                                 |
| -------------------------------- | --------------------------------------------------------------------------- |
| `.env`                           | Environment variables file containing `http_proxy`, `https_proxy`, and `no_proxy` in `key=value` format |
| `http.proxy`                     | Forward proxy URL with authentication for HTTP                              |
| `https.proxy`                    | Forward proxy URL with authentication for HTTPS                             |
| `context.token`                  | Authentication token for the proxy service                                  |
| `context.proxy.caCert`           | CA certificate for the Connectors proxy                                     |
| `connector.status.proxyAddress`  | Proxy address (see [Connectors Proxy](./connectors_proxy.mdx))              |

**Forward Proxy Usage:**

```bash
# Option 1
export http_proxy=$(cat /{mount-path}/http.proxy)
export https_proxy=$(cat /{mount-path}/https.proxy)

# Option 2
source /{mount-path}/.env
```

**Reverse Proxy Usage:**

```bash
export TOKEN=$(cat /{mount-path}/context.token)
export SERVER=$(cat /{mount-path}/connector.status.proxyAddress)

{cli} --server $SERVER --token $TOKEN
```

## CSI Volume Parameters

**Volume Parameters**

| Parameter  | Required | Description                 |
| ---------- | -------- | --------------------------- |
| readOnly   | Yes      | Must be `true`              |
| driver     | Yes      | Must be `connectors-csi`    |

**Volume Attributes**

| Parameter           | Required | Description                                              |
| ------------------- | -------- | -------------------------------------------------------- |
| connector.name      | Yes      | Connector name                                           |
| connector.namespace | No       | Connector namespace (defaults to Pod's namespace)        |
| configuration.names | No       | Comma-separated configuration names (e.g., `config1,config2`), the configuration names are the names of the configurations in the ConnectorClass |
| token.expiration    | No       | Token expiration time (default: `30m`)                   |

**Examples**

Mount a single configuration:

```yaml
volumes:
- name: config
  csi:
    driver: connectors-csi
    readOnly: true
    volumeAttributes:
      connector.name: "my-connector"
      configuration.names: "config1"
```

Mount multiple configurations:

```yaml
volumes:
- name: config
  csi:
    driver: connectors-csi
    readOnly: true
    volumeAttributes:
      connector.name: "my-connector"
      configuration.names: "config1,config2"
```

**Notes:**
- If `configuration.names` is omitted, only built-in configurations are mounted
- When multiple configurations contain files with the same name, later configurations overwrite earlier ones

## Configuration File Rendering \{#configuration-file-rendering}

The CSI Driver performs variable rendering when mounting configuration files, using [Go template](https://pkg.go.dev/text/template) syntax.

### Available Variables

| Variable                         | Description                                                                                                                    |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `.connector.status.proxyAddress` | Proxy address of the Connector; refer to [connectors-proxy](./connectors_proxy.mdx)                                            |
| `.connector.spec.*`              | Spec of the Connector, you can get all fields of the Connector Spec, eg. `.connector.spec.address` or `.connector.spec.params` |
| `.context.token`                 | Authentication token for accessing the proxy service                                                                           |
| `.context.proxy.caCert`          | CA certificate for accessing the connectors proxy (forward proxy); refer to [connectors-proxy](./connectors_proxy.mdx)         |

### Built-in Functions

Refer to [sprig](https://masterminds.github.io/sprig/) for supported functions

For example: `b64enc`: Base64 encoding of a string

### About the Proxy Service

Connectors provide a proxy service for each Connector, allowing clients to access target resources without needing to store the original credentials. For more details, please refer to [connectors-proxy](./connectors_proxy.mdx).

## Configuration examples \{#configuration-examples}

**Constant content**

``` yaml
apiVersion: connectors.alauda.io/v1alpha1
kind: ConnectorClass
metadata:
  name: my-git
spec:
  address:
    type: string
  configurations:
  - name: config
    data:
      .gitconfig: |
        this is git config
```

**Using connector.spec.params**

The following ConnectorClass defines a parameter `sslVerify` to control the SSL verification during `git clone`.

  ```yaml
  kind: ConnectorClass
  metadata:
    name: git
  spec:

    params:
    - name: sslVerify
      type: string
      default: "true"

    configurations:
    - name: config
      data:
        .gitconfig: |
          {{ $sslVerify := "true" -}}
          {{- range .connector.spec.params }}{{- if eq .name "sslVerify" }}{{$sslVerify = .value }}{{ end }}{{- end }}
          [http]
            sslVerify = {{ $sslVerify }}
  ```

**Using proxy service and token**

The following ConnectorClass provides a file named `.gitconfig`, which automatically injects headers and replaces the git URL during `git clone` by using the proxy service and token.

  ```yaml
  kind: ConnectorClass
  metadata:
    name: git
  spec:
    configurations:
    - name: config
      data:
        .gitconfig: |
          [http]
              extraHeader = Authorization: Basic {{ printf ":%s" .context.token | b64enc }}
          [url "{{ .connector.status.proxyAddress }}"]
              insteadOf = {{.connector.spec.address}}
  ```
